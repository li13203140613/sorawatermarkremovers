# Prompt Generator 功能改进完成

## 📋 需求总结

根据用户提出的三个需求，已完成以下改进：

### ✅ 需求 1: 分类信息包含在用户输入中
**简单模式和高级模式下，用户选择的风格（电影、人物、产品展示等）也要放到用户输入里**

**实现**:
- 简单模式：在发送给 API 的 `scene` 字段中添加分类信息
  ```
  分类：电影叙事
  描述：一个女孩在花园里弹吉他
  ```

- 高级模式：在所有字段之前添加分类信息
  ```
  分类：电影叙事
  创意描述：...
  风格：...
  镜头类型：...
  ```

**文件修改**: `components/prompt-generator/PromptGeneratorForm.tsx` (Lines 72-100)

---

### ✅ 需求 2: 高级模式添加创意描述字段
**高级模式也有创意描述，同样放到用户输入里**

**实现**:
- 在高级模式表单顶部新增"创意描述"文本框
- 标记为必填字段（红色星号）
- 提示文字："描述您的核心创意，下方的高级参数会帮助完善细节"
- 创意描述会自动添加到发送给 API 的 `scene` 字段中

**UI 位置**: 高级模式表单的第一个字段（在其他参数字段之前）

**文件修改**: `components/prompt-generator/PromptGeneratorForm.tsx` (Lines 211-228)

---

### ✅ 需求 3: 高级模式增加输出语言选择
**高级模式增加输出语言的选择**

**实现**:
- 添加"输出语言"下拉选择器
- 支持两种语言：
  - 中文 (zh)
  - English (en)
- 默认选择：中文
- 位置：与"生成提示词数量"并排显示（网格布局）
- 仅在高级模式下显示
- 选择的语言会传递给 API 的 `language` 参数

**文件修改**: `components/prompt-generator/PromptGeneratorForm.tsx` (Lines 294-341)

---

## 🎨 UI 变化

### 简单模式
- 无变化（用户体验不受影响）
- 后台自动添加分类信息到 API 请求

### 高级模式
**新增字段**:
1. **创意描述** (位于顶部)
   - 类型: 多行文本框 (Textarea)
   - 必填: ✅
   - 占位符: "例如: 一只橘猫在雨天走到街道上"
   - 行数: 3 行

2. **输出语言** (位于底部，与生成数量并排)
   - 类型: 下拉选择器 (Select)
   - 选项: 中文 / English
   - 默认: 中文
   - 提示: "选择生成提示词的语言"

**布局调整**:
```
┌─────────────────────────────────────┐
│  创意描述 *                          │
│  [文本框 - 3行]                      │
│  提示：描述您的核心创意...            │
└─────────────────────────────────────┘

┌──────────┬──────────┬──────────┐
│  风格    │  时长    │  氛围    │
│ [下拉框] │ [下拉框] │ [下拉框] │
└──────────┴──────────┴──────────┘
...（其他字段）...

┌──────────────────┬──────────────────┐
│ 生成提示词数量   │  输出语言         │
│ [下拉框: 1/3/5] │ [下拉框: 中文/英文]│
└──────────────────┴──────────────────┘
```

---

## 📊 API 请求格式变化

### 简单模式请求示例

**之前**:
```json
{
  "scene": "一个女孩在花园里弹吉他",
  "category": "cinematic",
  "count": 3,
  "language": "zh"
}
```

**现在**:
```json
{
  "scene": "分类：电影叙事\n描述：一个女孩在花园里弹吉他",
  "category": "cinematic",
  "count": 3,
  "language": "zh"
}
```

---

### 高级模式请求示例

**之前**:
```json
{
  "scene": "风格：Cinematic / 电影级\n时长：8 seconds\n氛围：孤独、宁静",
  "category": "cinematic",
  "count": 3,
  "language": "zh"
}
```

**现在**:
```json
{
  "scene": "分类：电影叙事\n创意描述：一只橘猫在雨天走到街道上\n风格：Cinematic / 电影级\n时长：8 seconds\n氛围：孤独、宁静\n镜头类型：Wide Shot / 全景\n主体描述：橘色虎斑猫\n动作描述：小心翼翼地走路，突然驻足仰头\n环境细节：被雨水浸湿的鹅卵石小巷，老旧砖墙，青苔\n光线类型：Warm Light / 暖色调光\n镜头运动：Tracking / 跟踪镜头",
  "category": "cinematic",
  "count": 3,
  "language": "en"  // 用户可选择英文输出
}
```

---

## 🔍 验证逻辑更新

### 简单模式
- 必须填写创意描述
- 错误提示: "请输入您的创意描述"

### 高级模式
- 必须填写创意描述 **或** 至少一个参数字段
- 错误提示: "请填写创意描述或至少一个字段参数"

---

## 📁 修改的文件

| 文件 | 变更类型 | 行数 | 说明 |
|------|---------|------|------|
| `components/prompt-generator/PromptGeneratorForm.tsx` | 修改 | 33, 72-100, 211-228, 294-341 | 核心逻辑和 UI 更新 |
| `app/[locale]/prompt-generator/page.tsx` | 修改 | 11 | 修复类型定义 |

---

## 🎯 测试场景

### 测试 1: 简单模式 - 分类信息传递
1. 打开 http://localhost:3000/zh
2. 选择"电影叙事"分类
3. 保持"简单模式"
4. 输入: "一个女孩在花园里弹吉他"
5. 点击"生成提示词"
6. **验证**: 打开开发者工具 Network 标签，查看请求体应包含:
   ```
   "scene": "分类：电影叙事\n描述：一个女孩在花园里弹吉他"
   ```

---

### 测试 2: 高级模式 - 创意描述字段
1. 切换到"高级模式"
2. **验证**: 看到顶部有"创意描述"文本框（带红色星号）
3. 填写创意描述: "一只橘猫在雨天走到街道上"
4. 填写其他参数:
   - 风格: Cinematic / 电影级
   - 时长: 8 seconds
   - 氛围: 孤独、宁静
5. 点击"生成提示词"
6. **验证**: 请求体的 `scene` 字段应包含所有信息，格式为:
   ```
   分类：电影叙事
   创意描述：一只橘猫在雨天走到街道上
   风格：Cinematic / 电影级
   时长：8 seconds
   氛围：孤独、宁静
   ```

---

### 测试 3: 高级模式 - 输出语言选择
1. 保持在"高级模式"
2. **验证**: 看到"输出语言"下拉框（与"生成提示词数量"并排）
3. 默认选项应为"中文"
4. 切换到"English"
5. 填写表单并生成
6. **验证**:
   - API 请求的 `language` 参数为 `"en"`
   - 生成的提示词应该是英文

---

### 测试 4: 高级模式 - 验证逻辑
1. 高级模式下，不填写任何内容
2. 直接点击"生成提示词"
3. **验证**: 显示错误提示 "请填写创意描述或至少一个字段参数"
4. 只填写"创意描述"，不填其他字段
5. 点击"生成提示词"
6. **验证**: 应该可以成功生成（因为有创意描述）

---

## ✅ 完成标准

- ✅ 简单模式自动添加分类信息
- ✅ 高级模式添加"创意描述"字段
- ✅ 高级模式添加"输出语言"选择器
- ✅ API 请求格式正确
- ✅ 验证逻辑更新
- ✅ TypeScript 编译通过
- ⏳ 浏览器功能测试（待执行）

---

## 🚨 注意事项

1. **创意描述字段共用状态**: 简单模式和高级模式共用同一个 `simpleIdea` 状态变量，意味着：
   - 从简单模式切换到高级模式时，输入的内容会保留在"创意描述"字段中
   - 从高级模式切换回简单模式时，"创意描述"的内容会显示在简单模式的文本框中
   - 这是有意设计，提供更好的用户体验

2. **输出语言选择器只在高级模式显示**: 简单模式默认使用中文输出，如果需要英文，用户需要切换到高级模式

3. **分类信息始终包含**: 无论简单模式还是高级模式，分类信息都会自动添加到 API 请求中，用户无需手动输入

---

**开发者**: Claude AI
**完成时间**: 2025-10-23
**文档版本**: 1.0

**状态**: ✅ 开发完成，等待测试验证
