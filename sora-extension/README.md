# Sora 视频去水印 Chrome 扩展

> 独立的浏览器扩展项目，不影响主站功能

## 📋 项目概述

这是一个 Chrome 浏览器扩展，用于在 Sora 视频页面上提供一键去水印下载功能。用户只需点击注入的下载按钮，即可自动提取视频链接、调用后端 API 处理并下载无水印视频。

---

## 🎯 核心功能点

### 第一期：最小闭环（MVP）

| 序号 | 功能点 | 详细说明 | 优先级 |
|------|--------|---------|--------|
| 1.1 | 扩展基础配置 | 创建 manifest.json，配置权限和内容脚本注入规则 | P0 |
| 1.2 | 页面检测 | Content Script 检测当前是否在 Sora 视频页面（URL 匹配 `/p/xxxxx`） | P0 |
| 1.3 | 链接提取 | 从当前页面 URL 提取视频分享链接 | P0 |
| 1.4 | 下载按钮注入 | 在视频右侧操作栏插入"下载"按钮（简单样式） | P0 |
| 1.5 | API 调用（未登录） | 点击按钮后，使用 visitorId 调用 `/api/video/process` 接口 | P0 |
| 1.6 | 视频下载 | 获取去水印 URL 后，触发浏览器下载 | P0 |
| 1.7 | 基础错误提示 | 显示处理中/成功/失败状态（简单文字提示） | P0 |

### 第二期：用户体验优化

| 序号 | 功能点 | 详细说明 | 优先级 |
|------|--------|---------|--------|
| 2.1 | Cookie 共享登录 | 读取网站 Supabase Cookie，自动同步登录状态 | P1 |
| 2.2 | 积分显示 | 在按钮旁显示当前剩余积分（已登录：数据库；未登录：Cookie） | P1 |
| 2.3 | 按钮样式优化 | 按钮样式与 Sora 原生按钮保持一致（图标+文字） | P1 |
| 2.4 | 处理进度优化 | 添加加载动画（旋转图标 + 百分比/状态文字） | P1 |
| 2.5 | Turnstile 验证 | 未登录用户首次使用时弹出人机验证 | P1 |
| 2.6 | 积分扣除同步 | Cookie 用户本地扣除，数据库用户刷新显示 | P1 |
| 2.7 | 扩展 Popup 页面 | 点击扩展图标显示：登录状态、积分余额、使用说明 | P1 |
| 2.8 | 错误处理完善 | 处理各种错误场景：积分不足、网络异常、链接无效等 | P1 |

### 第三期：高级功能

| 序号 | 功能点 | 详细说明 | 优先级 |
|------|--------|---------|--------|
| 3.1 | 下载历史记录 | 在 Popup 中显示最近 10 条下载记录（标题、时间、状态） | P2 |
| 3.2 | 批量下载 | 在列表页选择多个视频，批量下载 | P2 |
| 3.3 | 快捷键支持 | 添加快捷键（Ctrl+Shift+D）快速下载当前视频 | P2 |
| 3.4 | 下载成功通知 | 使用系统通知提醒用户下载完成 | P2 |
| 3.5 | 自定义设置 | 支持配置 API endpoint、下载路径、文件命名规则 | P2 |
| 3.6 | 下载队列管理 | 同时下载多个视频时，显示队列状态 | P2 |

---

## 📐 线框图设计

### 场景一：Sora 视频页面（注入下载按钮）

```
┌──────────────────────────────────────────────────────────────────────────────┐
│ sora.chatgpt.com/p/abc123                                           Chrome    │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  ┌─────────────────────────┐     ┌──────────────────────────────────────┐   │
│  │                         │     │  👤 lixiaofei                        │   │
│  │                         │     │  10-second TikTok-style ad of a...   │   │
│  │      🎬 Sora Logo       │     │                                      │   │
│  │                         │     │  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌──────┐│   │
│  │     ───────────         │     │  │ ♥  │ │ ↻  │ │ ↗  │ │ ⋯  │ │ 下载 ││   │
│  │    │    ▶    │          │     │  └────┘ └────┘ └────┘ └────┘ └──────┘│   │
│  │     ───────────         │     │   点赞   重做   分享   更多   🟢新增  │   │
│  │                         │     │                                      │   │
│  │   视频播放区域          │     │              ▲                        │   │
│  │                         │     │              │                        │   │
│  │   (600 x 600)           │     │     ┌────────┴────────┐              │   │
│  │                         │     │     │  扩展注入的按钮  │              │   │
│  │                         │     │     │  点击后自动提取  │              │   │
│  │  dew drop 产品广告      │     │     └─────────────────┘              │   │
│  │                         │     │                                      │   │
│  └─────────────────────────┘     │  ┌────────────────────────────────┐ │   │
│                                   │  │                                │ │   │
│                                   │  │     No comments yet            │ │   │
│                                   │  │                                │ │   │
│                                   │  └────────────────────────────────┘ │   │
│                                   └──────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────────────────────┘
```

**关键说明**：
- ✅ 在原有的 4 个按钮（点赞、重做、分享、更多）**最右侧**添加绿色"下载"按钮
- ✅ 按钮大小和样式与原生按钮保持一致
- ✅ 鼠标悬停时高亮显示

---

### 场景二：点击扩展图标（Popup 弹窗 - 第二期开发）

```
┌──────────────────────────────────────┐
│  🎬 Sora 去水印                      │
│  Video Downloader Extension          │
├──────────────────────────────────────┤
│                                      │
│  ┌────────────────────────────────┐ │
│  │  👤  已登录                    │ │
│  │      lixiaofei@example.com     │ │
│  └────────────────────────────────┘ │
│                                      │
│  ┌────────────────────────────────┐ │
│  │      剩余积分                  │ │
│  │                                │ │
│  │         12                     │ │
│  │      ████████░░░                │ │
│  └────────────────────────────────┘ │
│                                      │
│  ┌────────────────────────────────┐ │
│  │   立即下载当前视频  ✓          │ │
│  └────────────────────────────────┘ │
│                                      │
│  ┌────────────┐  ┌────────────────┐ │
│  │  充值积分  │  │   下载记录     │ │
│  └────────────┘  └────────────────┘ │
│                                      │
│  ┌────────────────────────────────┐ │
│  │ 💡 使用说明                    │ │
│  │ 1. 打开任意 Sora 视频页面      │ │
│  │ 2. 点击右侧绿色"下载"按钮      │ │
│  │ 3. 等待处理完成，自动下载      │ │
│  └────────────────────────────────┘ │
│                                      │
└──────────────────────────────────────┘
  (宽 400px × 高 550px)
```

---

### 场景三：下载流程演示

```
步骤 1: 初始状态          步骤 2: 处理中           步骤 3: 成功
┌──────────────┐         ┌──────────────┐        ┌──────────────┐
│              │         │              │        │              │
│  ┌────────┐  │   →     │  ┌────────┐  │   →    │     ┌─┐     │
│  │  下载  │  │         │  │ ⟳ 处理 │  │        │     │✓│     │
│  └────────┘  │         │  │  中... │  │        │     └─┘     │
│              │         │  └────────┘  │        │              │
│ 点击开始下载 │         │ 正在去水印   │        │ 下载成功！   │
│              │         │              │        │ video_xxx.mp4│
└──────────────┘         └──────────────┘        └──────────────┘


异常情况: 积分不足
┌──────────────┐
│              │
│     ┌─┐      │
│     │✕│      │
│     └─┘      │
│              │
│ 积分不足，   │
│ 请先充值     │
│              │
│ [前往充值]   │
└──────────────┘
```

---

## 🏗️ 项目结构

```
sora-extension/
├── manifest.json          # Manifest V3 配置文件
├── content.js             # 内容脚本（页面注入）
├── background.js          # Service Worker（后台服务）
├── popup.html             # 扩展弹窗页面（第二期）
├── popup.js               # 弹窗逻辑（第二期）
├── styles.css             # 按钮样式文件
├── icons/                 # 扩展图标资源
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── README.md              # 项目说明
├── ROADMAP.md             # 开发路线图
└── PRD.md                 # 产品需求文档
```

---

## 🚀 快速开始

### 安装方法

1. 打开 Chrome 浏览器，访问 `chrome://extensions/`
2. 开启右上角"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择 `sora-extension` 文件夹
5. 访问 https://sora.chatgpt.com/p/xxxxx 即可使用

### 使用方法

1. 打开任意 Sora 视频页面（URL 格式：`https://sora.chatgpt.com/p/xxxxx`）
2. 在视频右侧操作栏找到绿色"下载"按钮
3. 点击按钮，等待 5-10 秒处理
4. 浏览器自动下载无水印视频到默认下载目录

---

## 📚 文档索引

- [开发路线图](./ROADMAP.md) - 三期开发计划详情
- [产品需求文档](./PRD.md) - 详细的功能需求和技术方案
- [API 文档](../app/api/video/process/route.ts) - 后端接口说明

---

## 🎯 第一期验收标准

- [x] 在 Sora 视频页面能看到绿色"下载"按钮（在最右侧）
- [x] 点击按钮后，按钮文字变为"处理中..."
- [x] 5-10 秒后，浏览器自动开始下载视频文件
- [x] 下载成功后，按钮显示"✓ 已下载"
- [x] 如果失败，显示错误提示（如"积分不足"）

---

## 📝 开发日志

| 日期 | 版本 | 说明 |
|------|------|------|
| 2025-01-13 | v0.1.0 | 项目初始化，完成需求分析和线框图设计 |

---

## 🤝 贡献指南

本项目为内部项目，暂不接受外部贡献。
