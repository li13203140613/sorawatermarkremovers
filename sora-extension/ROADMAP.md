# Sora 扩展开发路线图

## 第一期：最小闭环（MVP）

**目标**：实现基础下载功能，验证技术可行性

| 序号 | 功能点 | 详细说明 | 工作量 |
|------|--------|---------|--------|
| 1.1 | 扩展基础配置 | 创建 manifest.json，配置权限和内容脚本注入规则 | 0.5h |
| 1.2 | 页面检测 | Content Script 检测当前是否在 Sora 视频页面（URL 匹配 `/p/xxxxx`） | 0.5h |
| 1.3 | 链接提取 | 从当前页面 URL 提取视频分享链接 | 0.5h |
| 1.4 | 下载按钮注入 | 在视频右侧操作栏插入"下载"按钮（简单样式） | 1h |
| 1.5 | API 调用（未登录） | 点击按钮后，使用 visitorId 调用 `/api/video/process` 接口 | 1h |
| 1.6 | 视频下载 | 获取去水印 URL 后，触发浏览器下载 | 0.5h |
| 1.7 | 基础错误提示 | 显示处理中/成功/失败状态（简单文字提示） | 0.5h |

**MVP 验收标准**：
- ✅ 在 Sora 视频页面能看到下载按钮
- ✅ 点击按钮能调用 API 并下载视频
- ✅ 错误时能显示提示信息

---

## 第二期：用户体验优化

**目标**：完善 UI、积分系统、登录状态同步

| 序号 | 功能点 | 详细说明 | 工作量 |
|------|--------|---------|--------|
| 2.1 | Cookie 共享登录 | 读取网站 Supabase Cookie，自动同步登录状态 | 1.5h |
| 2.2 | 积分显示 | 在按钮旁显示当前剩余积分（已登录：数据库；未登录：Cookie） | 1h |
| 2.3 | 按钮样式优化 | 按钮样式与 Sora 原生按钮保持一致（图标+文字） | 1h |
| 2.4 | 处理进度优化 | 添加加载动画（旋转图标 + 百分比/状态文字） | 0.5h |
| 2.5 | Turnstile 验证 | 未登录用户首次使用时弹出人机验证 | 1.5h |
| 2.6 | 积分扣除同步 | Cookie 用户本地扣除，数据库用户刷新显示 | 0.5h |
| 2.7 | 扩展 Popup 页面 | 点击扩展图标显示：登录状态、积分余额、使用说明 | 2h |
| 2.8 | 错误处理完善 | 处理各种错误场景：积分不足、网络异常、链接无效等 | 1h |

**第二期验收标准**：
- ✅ 网站登录后，扩展自动识别登录状态
- ✅ 按钮样式美观，符合 Sora 设计风格
- ✅ 积分余额实时显示
- ✅ 完整的错误提示和引导

---

## 第三期：高级功能

**目标**：提升便利性和用户粘性

| 序号 | 功能点 | 详细说明 | 工作量 |
|------|--------|---------|--------|
| 3.1 | 下载历史记录 | 在 Popup 中显示最近 10 条下载记录（标题、时间、状态） | 2h |
| 3.2 | 批量下载 | 在列表页选择多个视频，批量下载 | 3h |
| 3.3 | 快捷键支持 | 添加快捷键（Ctrl+Shift+D）快速下载当前视频 | 1h |
| 3.4 | 下载成功通知 | 使用系统通知提醒用户下载完成 | 0.5h |
| 3.5 | 自定义设置 | 支持配置 API endpoint、下载路径、文件命名规则 | 2h |
| 3.6 | 下载队列管理 | 同时下载多个视频时，显示队列状态 | 2h |
| 3.7 | 性能优化 | 减少 DOM 查询、缓存 API 结果、节流防抖 | 1h |

**第三期验收标准**：
- ✅ 支持批量操作
- ✅ 完善的历史记录管理
- ✅ 快捷键和自定义配置
- ✅ 流畅的用户体验

---

## 技术债务和优化项

| 项目 | 说明 | 优先级 |
|------|------|--------|
| 国际化支持 | 支持中英文切换 | P2 |
| 自动更新检测 | 检查扩展新版本并提示更新 | P3 |
| 数据统计 | 统计使用次数、成功率等（匿名） | P3 |
| 暗色模式 | 适配 Sora 的暗色主题 | P2 |

---

## 第一期核心文件清单

```
sora-extension/
├── manifest.json          # V3 配置，权限声明
├── content.js             # 按钮注入、链接提取、事件监听
├── background.js          # API 调用、下载触发
├── styles.css             # 按钮基础样式
└── icons/
    ├── icon16.png
    ├── icon48.png
    └── icon128.png
```

**预计第一期完成时间**：4-5 小时
